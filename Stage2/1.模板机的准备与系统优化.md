# 模板机的准备与系统优化

#### 后续的虚拟机使用模板机进行克隆并修改

### 模板机的安装

![image-20251128152501893](C:\Users\yellowsea\AppData\Roaming\Typora\typora-user-images\image-20251128152501893.png)

进入到设备类型选择标准分区，添加boot、swap、/根的挂载点，分配空间分别为200MB、2GB、全部（不用写）

![image-20251128152639131](C:\Users\yellowsea\AppData\Roaming\Typora\typora-user-images\image-20251128152639131.png)

![image-20251128152919758](C:\Users\yellowsea\AppData\Roaming\Typora\typora-user-images\image-20251128152919758.png)

接受更改

![image-20251128152950006](C:\Users\yellowsea\AppData\Roaming\Typora\typora-user-images\image-20251128152950006.png)

###### 系统安装完成后，应该在虚拟机设置中，需要添加一个网卡为内网通信做准备

这个网卡默认的名称是ens36

![image-20251128150355076](C:\Users\yellowsea\AppData\Roaming\Typora\typora-user-images\image-20251128150355076.png)

修改ens33

![image-20251128155030658](C:\Users\yellowsea\AppData\Roaming\Typora\typora-user-images\image-20251128155030658.png)

cp一下ens33，将其作为ens36的配置（不需要网关和DNS）

![image-20251128161110619](C:\Users\yellowsea\AppData\Roaming\Typora\typora-user-images\image-20251128161110619.png)

###### 安装network

需要重启网卡配置才能生效，还没有systemctl指令，事已至此，先安装一个吧

> [!NOTE]
>
> 哦对了，还要把防火墙也关了

```bash
yum -y install network-scripts
systemctl restart network

systemctl stop firewalld
systemctl disable firewalld
```

![image-20251128161338727](C:\Users\yellowsea\AppData\Roaming\Typora\typora-user-images\image-20251128161338727.png)

可以看到重启之后ens36的配置也是正确的，但是也要ping一下

###### 修改PS1(重要)

> [!IMPORTANT]
>
> 纯粹是个人偏好罢了，不是彩色的看着不舒服（重要），至少看着舒服一点才有敲代码的动力嘛

```bash
export PS1="[\[\e[34;1m\]\u@\[\e[0m\]\[\e[32;1m\]\H\[\e[0m\]\[\e[31;1m\] \W\[\e[0m\]]\\$"
```

###### 配置epel仓库

```bash
wget -O /etc/yum.repos.d/epel.repo https://mirrors.aliyun.com/repo/epel-7.repo
```

###### 安装常用的软件

```bash
yum -y install lrzsz ntpdate
```

###### 时间同步

```bash
vim /etc/crontab 
*/15 * * * * root ntpdate ntp1.aliyun.com &> /dev/null
```

###### 设置语言

```bash
localectl set-locale LANG=en_US.UTF-8
source /etc/locale.conf 
```

###### 屏蔽tmp的挂载

> [!IMPORTANT]
>
> [mask与disable的区别](#区分 `systemctl mask` 和 `systemctl disable`)

```bash
umount /tmp
systemctl mask tmp.mount
```

###### 加大文件描述符

这个设置要重启才能生效

```bash
ulimit -n		# 查看默认的文件描述符的数量
echo "* - nofile 65535" >> /etc/security/limits.conf
```



## 区分 `systemctl mask` 和 `systemctl disable`

在服务管理的语境中，`systemctl disable` 和 `systemctl mask` 两个命令通常被使用来限制或阻止服务的运行。然而，它们之间存在一些关键的区别。

- **`systemctl disable` 命令：** 用于禁用一个服务或者禁用一个服务的启动和停止。当你禁用一个服务后，系统将不再自动启动该服务，但仍然允许手动启动。
- **`systemctl mask` 命令：** 用于屏蔽一个服务，将其单元文件链接到 `/dev/null`，使其无法被 `systemctl` 启动。屏蔽后，即使尝试手动启动服务，也将无法成功。