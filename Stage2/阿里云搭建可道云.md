# 阿里云搭建可道云

需要在阿里云上准备ECS、SLB、Redis、MySQL、OSS、NAS

## 在ECS上配置可道云

### ECS的准备

创建实例，选择系统为CentOS7.9,不需要公网IP（稍后可以设置弹性公网IP），登录凭证自定义账号密码。

### 绑定弹性公网

申请一个弹性公网，然后绑定ECS实例，通过Xshell连接到公网IP，配置Nginx库、上传PHP组件并且用yum指令附带安装依赖、使用wget下载有道云

```bash
vim /etc/yum.repos.d/nginx.repo
```

```bash
[nginx-stable]
name=nginx stable repo
baseurl=https://nginx.org/packages/centos/$releasever/$basearch/
gpgcheck=0
enabled=1
gpgkey=https://nginx.org/keys/nginx_signing.key
```

```bash
yum -y install nginx
```

这里要把Nginx配置文件中的用户改为Apache，与php相同

```bash
vim /etc/nginx/nginx.conf
```

这里的php71.tar.gz早就上传好了

```bash
yum -y install lrzsz	# CentOS7并不自带lrzsz
```

```bash
tar -xf php71.tar.gz
```

```bash
yum -y install $(ls | grep -v php71.tar.gz)
```

```bash
mkdir -p /code
```

```bash
cd /code
```

```bash
 wget https://static.kodcloud.com/update/download/kodbox.1.30.zip
```

CentOS不自带unzip所以要先下载unzip

```bash
yum -y install unzip
```

```bash
unzip kodbox.1.30.zip
```

### 配置SLB

创建传统型负载均衡CLB后，进行端口转发的配置

可以配置转发到后端的22端口的4层负载

也可以配置特定请求转发到后端80端口的7层负载

### 配置Redis

别忘了配置**白名单**和**免密登录**

### 配置MySQL

也需要配置白名单，但是需要配置用户，而且最高权限用户只能配置一个，普通用户则可以配置任意多个

### 配置NAS

静态资源共享……

### 配置OSS对象存储

需要在**主账号**下创建一个用户，专门用于管理OSS权限，权限为AliyunOSSFullAccess

### 配置DNS解析

这里可以DNS解析到A记录，也可以搭配CDN（内容分发网络）配置CNAME，让用户请求最佳的CDN结点

### 配置CDN内容分发网络

使用刷新与预热服务

- 刷新可以强制清空CDN中的缓存，更新相关内容
- 预热可以让内容提前加载到CDN，减轻源站压力

### 配置WAF防火墙

云锁……

### 配置ESS弹性伸缩

可以通过制定规则，使服务器压力大时自动扩容，压力小时自动缩容

### 配置NAT网关

制定出网入网规则……

其实上面没写具体步骤是因为只需要图形化操作
